!function(t){"use strict";function e(t){return!!t}function n(t){return t.isContext?t:new h(t)}function r(){if(x.logLevel<=d.debug){var t;(t=console).log.apply(t,arguments)}}function i(){if(x.logLevel<=d.info){var t;(t=console).log.apply(t,arguments)}}function o(){if(x.logLevel<=d.error){var t;(t=console).log.apply(t,arguments)}}var u=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},c=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];u(this,t),this.contexts=e}return s(t,[{key:"has",value:function(t,e){return this.contexts.some(function(n){return n.has(t,e)})}},{key:"get",value:function(t,e){for(var n=0;n<this.contexts.length;n++){var r=this.contexts[n],i=r.get(t,e);if(i)return i}}}]),t}(),f=Symbol("DefaultContext"),l=function(){function t(e){var n=e.injector,r=e.config,i=void 0===r?null:r;u(this,t),this.injector=n,this.config=i}return s(t,[{key:"setConfig",value:function(t){this.config=t}},{key:"register",value:function(t,e){return this.injector.register(t,e)}},{key:"load",value:function(t){for(var e,n=this.getDefaultContext(),r=this.getConfiguredContext(t),i=arguments.length,o=Array(i>1?i-1:0),u=1;u<i;u++)o[u-1]=arguments[u];return(e=this.injector).load.apply(e,[t,n,r].concat(o))}},{key:"getDefaultContext",value:function(){var t=this.config[f];return this.getContext(t)}},{key:"getConfiguredContext",value:function(t){var e=this.config[t];return this.getContext(e)}},{key:"getContext",value:function(t){return t instanceof Function?t():t||void 0}}]),t}(),h=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u(this,t),this.values=e,this.isContext=!0}return s(t,[{key:"has",value:function(t){return!!this.values[t]}},{key:"get",value:function(t){return this.values[t]}}]),t}(),v=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];u(this,t),this.contexts=e}return s(t,[{key:"add",value:function(){var t;(t=this.contexts).push.apply(t,arguments)}},{key:"getContext",value:function(t){for(var e=0;e<this.contexts.length;e++){var n=this.contexts[e];if(n.has(t,this))return n}}},{key:"getModule",value:function(t){for(var e=0;e<this.contexts.length;e++){var n=this.contexts[e],r=n.get(t,this);if(r)return{instance:r,context:n,key:t}}return{}}}]),t}(),g=function(){function t(){u(this,t),this.listeners=[]}return s(t,[{key:"on",value:function(t){var e=this;return this.listeners.push(t),function(){return e.off(t)}}},{key:"off",value:function(t){for(var e=void 0;-1!==(e=this.listeners.indexOf(t));)this.listeners.splice(e,1)}},{key:"dispatch",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];this.listeners.forEach(function(t){return t.apply(void 0,e)})}}]),t}(),y=function(){function t(e){var n=e.registry,r=e.cache,i=e.construct,o=e.defaultContext;u(this,t),this.registry=n,this.cache=r,this.construct=i,this.defaultContext=o}return s(t,[{key:"getAvailableContexts",value:function(t){var r=new v,i=t.filter(e).map(n).reverse();return r.add.apply(r,a(i).concat([this.defaultContext])),r}},{key:"register",value:function(t,e){return this.registry.register(t,e)}},{key:"load",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var i=this.getAvailableContexts(n);return this.cache.get(t,i)||this.construct.get(t,i)}}]),t}(),d={debug:1,info:2,error:3},x={logLevel:d.info},C=Object.freeze({debug:r,info:i,error:o,LOGLEVEL:d,preferences:x}),p=function(){function t(){u(this,t),this.values={}}return s(t,[{key:"add",value:function(t,e){this.values[t]=this.values[t]||[],-1===this.values[t].indexOf(e)&&(r("Add to cache",t.toString()),this.values[t].push(e))}},{key:"has",value:function(t,e){return!!this.__get(t,e)}},{key:"get",value:function(t,e){var n=this.__get(t,e);if(n)return r("Loaded cached instance of",t.toString()),n}},{key:"__get",value:function(t,e){var n=this,r=this.values,i=r[t];if(i)return i.find(function(t){var r=t.__creationScope.usedContexts;return n.canUseScope(r,e)})}},{key:"canUseScope",value:function(t,e){return t.every(function(t){var n=t.context,r=t.key;return n===e.getContext(r)})}}]),t}(),k=function(){function t(e){var n=e.registry,r=e.args,i=e.cache;u(this,t),this.args=r,this.registry=n,this.cache=i}return s(t,[{key:"has",value:function(t){return!!this.registry.get(t)}},{key:"get",value:function(t,e){var n={},i=[],o={id:n,availableContexts:e,usedContexts:i},u=this.registry.get(t);if(u){var s=new u(this.args.get(o));return Object.defineProperty(s,"__creationScope",{get:function(){return o}}),r("Created new instance of",t.toString()),this.cache.add(t,s),s}}}]),t}(),b=function(){function t(){u(this,t)}return s(t,[{key:"get",value:function(t){var e=this;return new Proxy({},{get:function(n,r){return e.getInstance(r,t)}})}},{key:"getInstance",value:function(t,e){var n=e.availableContexts.getModule(t),r=n.context,i=n.instance;if(!i)throw new Error("Not found");var o=i.__creationScope;if(o){if(o.availableContexts===e.availableContexts){var u;(u=e.usedContexts).push.apply(u,a(o.usedContexts))}}return e.usedContexts.push({context:r,key:t}),i}}]),t}(),m=function(){function t(){u(this,t),this.registered=new g,this.modules={}}return s(t,[{key:"register",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Symbol(t.name);return this.modules[e]=t,this.registered.dispatch(e),e}},{key:"get",value:function(t){return this.modules[t]}}]),t}();t.CompositeContext=c,t.ConfigurableInjector=l,t.Context=h,t.ContextList=v,t.DefaultContext=f,t.EventSource=g,t.Injector=y,t.Log=C,t.ModuleCache=p,t.ModuleConstructor=k,t.ProxyArguments=b,t.Registry=m}(this.modulinDi=this.modulinDi||{});
